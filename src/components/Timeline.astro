---
interface TimelineItem {
  year: string;
  title: string;
  subtitle?: string;
  description?: string;
  highlight?: boolean;
}

interface Props {
  items: TimelineItem[];
}

const { items } = Astro.props;
---

<div class="relative">
  <!-- Vertical line -->
  <div class="absolute left-4 md:left-1/2 md:-translate-x-px top-0 bottom-0 w-0.5 bg-neutral-200 dark:bg-neutral-800"></div>

  <!-- Timeline items -->
  <div class="space-y-8">
    {items.map((item, index) => (
      <div
        class="timeline-item relative flex flex-col md:flex-row md:items-center gap-4 md:gap-8 opacity-0"
        style={`animation-delay: ${index * 100}ms`}
      >
        <!-- Year badge - visible on mobile on left, desktop alternates -->
        <div class={`
          md:w-1/2
          ${index % 2 === 0 ? 'md:order-1 md:text-right' : 'md:order-3 md:text-left'}
        `}>
          <div class={`
            inline-flex items-center gap-2 text-sm font-medium
            ${item.highlight
              ? 'text-orange-600 dark:text-orange-400'
              : 'text-neutral-500 dark:text-neutral-400'
            }
          `}>
            <span class="md:hidden w-2 h-2 rounded-full bg-current"></span>
            {item.year}
          </div>
        </div>

        <!-- Circle marker - centered on line -->
        <div class="absolute left-4 md:left-1/2 -translate-x-1/2 order-2">
          <div class={`
            w-3 h-3 rounded-full border-2 bg-white dark:bg-neutral-950
            ${item.highlight
              ? 'border-orange-500'
              : 'border-neutral-300 dark:border-neutral-600'
            }
          `}></div>
        </div>

        <!-- Content card -->
        <div class={`
          ml-10 md:ml-0 md:w-1/2
          ${index % 2 === 0 ? 'md:order-3 md:pl-8' : 'md:order-1 md:pr-8'}
        `}>
          <div class={`
            p-4 rounded-lg border transition-colors
            ${item.highlight
              ? 'bg-orange-50/50 dark:bg-orange-950/20 border-orange-200 dark:border-orange-800/50'
              : 'bg-neutral-50 dark:bg-neutral-900/50 border-neutral-200 dark:border-neutral-800'
            }
          `}>
            <h3 class="font-semibold text-neutral-900 dark:text-white">
              {item.title}
            </h3>
            {item.subtitle && (
              <p class="text-sm text-neutral-600 dark:text-neutral-400 mt-1">
                {item.subtitle}
              </p>
            )}
            {item.description && (
              <p class="text-sm text-neutral-500 dark:text-neutral-500 mt-2">
                {item.description}
              </p>
            )}
          </div>
        </div>
      </div>
    ))}
  </div>
</div>

<style>
  .timeline-item {
    animation: slide-up 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Intersection Observer for scroll-triggered animations
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.style.animationPlayState = 'running';
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    }
  );

  document.querySelectorAll('.timeline-item').forEach((item) => {
    (item as HTMLElement).style.animationPlayState = 'paused';
    observer.observe(item);
  });
</script>
